# “NH”游戏饰品交易平台 需求与架构设计总览

**文档版本**: 1.1
**日期**: 2025-07-04

---

## 1. 项目立项

### 1.1 项目背景与动机
随着以《CS:GO》、《DOTA2》为代表的电子竞技游戏风靡全球，游戏内的虚拟饰品（皮肤、道具等）已经超越了其使用价值，衍生出了庞大的收藏、投资和交易市场。玩家对于饰品交易的安全性、便捷性和价格合理性提出了越来越高的要求。

目前市场存在两种主流交易模式：
1.  **官方市场（如 Steam 社区市场）**: 安全性高，但手续费昂贵（约15%），且资金无法直接提现，生态相对封闭。
2.  **第三方C2C平台**: 手续费低廉，支持现金交易，模式灵活，是当前玩家的主流选择。

然而，现有的第三方平台仍存在API劫持、交易欺诈、响应速度慢等痛点。因此，开发一个更安全、更高效、用户体验更佳的"NH游戏饰品交易平台"具有明确的市场需求和商业价值。

### 1.2 项目目标与范围

#### 1.2.1 项目目标
*   **近期目标**: 打造一个安全、可靠、功能完善的《CS:GO》饰品交易平台，提供P2P交易、库存管理、饰品检视等核心功能，在一年内获取1万名活跃用户。
*   **中期目标**: 扩展支持《DOTA2》等更多游戏品类，推出移动端App，并引入数据分析、价格预测等增值服务。
*   **长期目标**: 成为国内领先的综合性游戏虚拟资产交易服务平台，探索更多元的盈利模式。

#### 1.2.2 项目范围
本项目一期范围主要包括：
*   **平台覆盖**: Web端平台。
*   **游戏支持**: 仅支持《CS:GO》。
*   **核心功能**: 用户系统（对接Steam）、库存管理、饰品上架（出售）、求购、P2P交易撮合、订单管理、在线客服。

---

## 2. 可行性分析

### 2.1 市场与竞品分析

#### 2.1.1 市场概述
全球游戏饰品交易市场规模已达百亿美金级别，且仍在高速增长。国内市场用户基数庞大，付费意愿强，但市场竞争也日趋激烈。

#### 2.1.2 国内外主要竞品对比

| 平台名称             | 运营方       | 核心优势                                                                 | 核心劣势                                                               | 商业模式/手续费                                             |
| :------------------- | :----------- | :----------------------------------------------------------------------- | :--------------------------------------------------------------------- | :---------------------------------------------------------- |
| **网易BUFF**         | 网易         | 用户基数最大，市场垄断地位；功能全面，社区活跃。                         | 交易高峰期可能卡顿；无明显价格优势。                                   | 交易手续费~2.5%，提现手续费~1%。                             |
| **C5GAME**           | 星巢网络     | 曾有价格优势，支持多种交易方式。                                         | 近年市场份额被压缩，用户活跃度下降。                                   | 交易手续费~2%，有封顶。                                     |
| **IGXE**             | IGXE         | 老牌平台，曾推出创新的P2P交易模式。                                      | 经历过"红信"风波，用户信任度受损。                                     | 手续费较低，活动较多。                                      |
| **Steam 社区市场**   | Valve (官方) | 绝对安全，与游戏无缝集成。                                               | 15%超高手续费；余额无法提现；有7天交易冷却限制。                       | 15%交易税。                                                 |
| **完美世界竞技平台** | 完美世界     | 国服代理，理论上拥有"T0交易"（无冷却期）特权，具备官方背书的安全性。 | 起步晚，用户量和饰品池较小，生态建设中。                               | 尚未大规模推广，手续费策略不明朗。                          |

**结论**: 市场虽有巨头，但仍在用户体验、交易效率和安全性上存在优化空间。"NH"平台可以从 **更优的撮合算法、更极致的交易安全保障、更流畅的P2P交易体验** 作为切入点，争取核心用户。

### 2.2 技术可行性
*   **Steam API**: Valve提供了稳定的Web API用于获取用户库存、发起交易等，技术上完全可行。
*   **P2P交易实现**: 可通过让买卖双方的好友位作为"中转站"或直接向双方客户端发送交易报价的方式实现，技术成熟。
*   **团队能力**: 项目所需技术栈（Spring Cloud, Vue.js, Redis, RabbitMQ等）均为业界主流技术，现有 `e-business` 项目已搭建了良好的微服务基础，团队具备相应的开发能力。

### 2.3 经济可行性
*   **收入来源**: 早期主要依靠向卖家收取交易手续费（可设定低于竞品的费率，如1.5%-2%）。
*   **成本构成**: 主要为服务器成本、研发人力成本、第三方服务（短信、云存储）费用和市场推广费用。
*   **盈利预测**: 在达到1万活跃用户的目标后，按平均客单价和交易频率计算，手续费收入预计可以覆盖服务器及运营成本，实现盈亏平衡。

### 2.4 操作可行性
平台运营需要客服团队处理交易纠纷、进行用户引导。推广上可以与游戏主播、内容创作者合作，精准触达目标用户。操作流程清晰，风险可控。

---

## 3. 需求分析

### 3.1 用户角色与职责
| 用户角色     | 职责描述                                                                                                                                                                                                                              |
| :----------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **买家**     | 浏览/搜索饰品，查看饰品详情（磨损、印花、3D检视），发起购买或求购，与卖家进行交易，评价交易。                                                                                                                                          |
| **卖家**     | 同步Steam库存，选择饰品上架出售（定价），接收报价，与买家进行交易，管理在售商品。                                                                                                                                                      |
| **平台管理员** | 管理用户、处理交易纠纷、监控异常交易、配置平台参数（手续费率等）、发布公告。                                                                                                                                                          |
| **仲裁客服** | 在买卖双方出现交易争议时介入，根据双方提供的证据和平台规则进行裁定。                                                                                                                                                                    |

### 3.2 功能性需求 (部分核心)
| 核心域       | 功能模块           | 详细功能描述                                                                                                                            | 关联服务         |
| :----------- | :----------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :--------------- |
| **用户与库存** | 用户系统 (UC1)     | 通过Steam OpenID进行注册/登录；管理个人资料；**管理和刷新交易链接 (API Key)**。                                                           | `user-service`   |
|              | 库存服务 (UC2)     | 定时或手动通过Steam API同步用户公开库存内的饰品数据。                                                                                   | `item-service`   |
| **交易核心** | 饰品上架 (UC3)     | 卖家从库存中选择饰品，设定价格（或参考价）上架到平台市场。                                                                              | `trade-service`  |
|              | 市场浏览 (UC4)     | 买家按游戏、类型、外观、价格等多维度筛选和搜索饰品。                                                                                    | `item-service`   |
|              | **P2P交易 (UC5)**  | 买家下单后，系统向卖家机器人或卖家本人发起取货报价；取货成功后，向买家发起发货报价；**全程监控报价状态**。                              | `trade-service`  |
|              | 订单管理 (UC6)     | 用户查看个人所有订单的状态（待付款、待发货、已完成、已取消、纠纷中）。                                                                  | `trade-service`  |
| **支撑功能** | 支付服务 (UC7)     | 集成支付宝、微信支付，用户充值余额，或支付订单。支持提现申请。                                                                          | `pay-service`    |
|              | 饰品检视 (UC8)     | 通过第三方服务或自建服务，提供饰品在游戏中的高清截图或3D模型预览。                                                                      | `item-service`   |

### 3.3 非功能性需求
| 类别       | 需求描述                                                                                                                               | 关键指标/实现策略                                                                                                                                                                |
| :--------- | :------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **性能**   | 热门饰品页面加载迅速，高频交易时段系统稳定。                                                                                             | - **交易撮合**: 内存级撮合引擎，响应时间 < 100ms。<br>- **库存同步**: 采用消息队列异步处理，避免阻塞。                                                                       |
| **安全性** | **防止API劫持和交易欺诈是最高优先级**。                                                                                                  | - **交易验证**: 在最终确认交易报价前，强制验证收货方的Steam注册时间、等级等关键信息，并向用户弹窗提醒。<br>- **API Key保护**: API Key加密存储，并设置定时失效提醒。 |
| **数据一致性** | 保证平台订单状态与Steam交易状态的最终一致性。                                                                                        | - **状态机**: 引入可靠的状态机管理订单流转。<br>- **定时对账**: 定时任务轮询核对超时的、状态模糊的交易，进行校准或关闭。                                                     |
| **可用性** | 保证7x24小时不间断服务。                                                                                                               | 达到 99.95% 可用性。采用与通用电商类似的集群、熔断、降级策略。                                                                                                                   |

---

## 4. 系统架构设计

### 4.1 总体架构
维持 **前后端分离** 和 **微服务** 架构。关键在于引入与 **Steam服务** 交互的适配层，并强化 **交易服务** 的能力。

![系统架构图](https://i.imgur.com/example.png)  (此处应有更新的架构图)

> **[-> 点击查看：API 网关架构图](./07-API网关/api_gateway_architecture.puml)** (可复用)

### 4.2 应用架构（微服务划分）
在原有服务基础上，进行调整和强化：

*   `user-service`: 核心职责不变，增加对Steam用户信息的管理。
*   `item-service`: 增加 **Steam库存同步器** 和 **饰品检视服务** 的集成。
*   `trade-service`: **架构核心**。内部包含**报价管理器**、**交易撮合引擎**、**订单状态机**等复杂组件。
*   **新增 `steam-adapter-service` (建议)**: 创建一个专门的 **Steam适配器服务**，所有与Steam API的直接交互（获取库存、发送报价）都由该服务统一处理。这样做的好处是：
    1.  **隔离变化**: 如果未来Steam API变更，只需修改此服务。
    2.  **管理API Key池**: 可以管理一组机器人账号或API Key，进行负载均衡和高可用。
    3.  **统一风控**: 可以在此服务层做统一的API频率控制和风控。

> **[-> 点击查看：微服务通信细节](./03-微服务通信与协作/README.md)** (需更新以包含新服务)

### 4.3 数据架构
> **[-> 点击查看：数据库E-R图](./01-数据库结构与关系/database_erd.puml)** (需扩展，增加交易报价表、库存快照表等)

#### 4.3.1 核心数据表设计（概念）
*   **饰品表 (Items)**: 除去基础信息，增加 `wear` (磨损度), `paint_seed` (模板ID), `stickers` (印花信息) 等游戏内特有属性。
*   **交易报价表 (Trade_Offers)**: 记录每一次向Steam发起的交易报价ID、状态、参与方、关联订单号，用于跟踪和对账。

### 4.4 技术栈选型
技术栈基本保持不变，但在特定领域引入更合适的工具：
*   **交易撮合引擎**: 可以考虑使用高性能的内存数据库（如Redis）或专门的撮合引擎库来实现，以满足高频交易需求。
*   **定时任务**: 使用 XXL-Job 或 Spring Quartz 等分布式任务调度框架，执行库存同步、交易对账等任务。

> **[-> 点击查看：CI/CD 流程图](./09-部署与运维/cicd_flow.puml)** (可复用)

---

## 5. 附录

### 5.1 术语表
*   **SRS**: Software Requirements Specification (软件需求规格说明书)
*   **JWT**: JSON Web Token
*   **SPU**: Standard Product Unit (标准化产品单元)
*   **SKU**: Stock Keeping Unit (库存量单位)

### 5.2 修订历史
| 版本 | 日期       | 修订人 | 修订说明     |
| :--- | :--------- | :----- | :----------- |
| 1.0  | 2024-07-04 | AI助手 | 创建初始版本 |
| 1.1  | 2025-07-04 | AI助手 | 更新架构图   |

</rewritten_file> 