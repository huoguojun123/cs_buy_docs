@startuml 电商平台订单处理流程

' 样式设置
skinparam activity {
  BackgroundColor White
  BorderColor Black
  ArrowColor Black
}

|客户端|
start
:浏览商品;
:选择商品加入购物车;
:进入购物车;
:选择要购买的商品;
:填写收货地址和支付方式;
:提交订单;

|网关服务|
:接收订单请求;
:路由到交易服务;

|交易服务|
:验证订单参数;
:计算订单金额;

|商品服务|
:获取商品详情;
:验证商品状态;

|库存服务|
:检查库存;

if (库存充足?) then (是)
  :锁定库存;
  |交易服务|
  :生成订单号;
  :创建订单记录;
  :返回订单创建成功;
  
  |客户端|
  :跳转到支付页面;
  :选择支付方式;
  :确认支付;
  
  |支付服务|
  :验证订单信息;
  :处理支付请求;
  
  if (支付成功?) then (是)
    :记录支付信息;
    |交易服务|
    :更新订单状态为已支付;
    |库存服务|
    :扣减库存;
    |通知服务|
    :发送支付成功通知;
    |卖家端|
    :接收新订单通知;
    :准备发货;
    :确认发货;
    |交易服务|
    :更新订单状态为已发货;
    |通知服务|
    :发送发货通知;
    |客户端|
    :接收发货通知;
    :确认收货;
    |交易服务|
    :更新订单状态为已完成;
    |评价服务|
    :等待买家评价;
  else (否)
    |支付服务|
    :返回支付失败;
    |交易服务|
    :支付超时;
    :取消订单;
    |库存服务|
    :释放锁定库存;
    |通知服务|
    :发送订单取消通知;
  endif
else (否)
  |交易服务|
  :返回库存不足;
  |客户端|
  :显示库存不足;
endif

|客户端|
stop

@enduml 