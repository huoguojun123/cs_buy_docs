@startuml
title "活动图 - 库存管理核心流程"

|场景|
start
partition "下单锁定库存" {
    :用户提交订单;
    :系统创建订单(待支付);
    :从物理库存中划拨, 增加**锁定库存**;
    note right: 物理库存 = 可用库存 + 锁定库存
}
partition "支付成功扣减库存" {
    :用户支付成功;
    :系统更新订单(已支付);
    :减少**锁定库存**;
    :减少**物理库存**;
}
partition "订单取消/支付超时" {
    :订单被用户取消或支付超时;
    :系统关闭订单;
    :减少**锁定库存**, 归还为可用库存;
}
partition "退货入库" {
    :仓库收到退货并验货通过;
    :系统处理退款单;
    :增加**物理库存**;
}
partition "后台手动调整" {
    :管理员在后台调整库存;
    :直接修改**物理库存**数量;
    :记录库存变更日志(重要);
}
stop

@enduml 