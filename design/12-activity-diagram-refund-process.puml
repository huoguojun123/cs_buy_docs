@startuml
title "活动图 - 售后退款流程"

|用户|
start
:在"我的订单"页面找到已完成的订单;
:点击"申请售后";
:选择需要退货的商品;
:填写退款原因和说明;
:上传相关凭证(照片);
:提交申请;

|系统|
:创建售后单 (状态: PENDING_APPROVAL);

|客服/管理员|
:在后台审核售后单;
:查看用户申请理由和凭证;
if (审核是否通过?) then (是)
  |系统|
  :更新售后单状态为 'APPROVED';
  :通过系统消息/短信通知用户;
  |用户|
  :收到审核通过通知;
  :将商品寄回指定仓库地址;
  :在售后页面填写物流单号;
  |仓库管理员|
  :等待接收退货;
  :收到退货后进行验货;
  if (货物完好?) then (是)
    |系统|
    :更新售后单状态为 'GOODS_RECEIVED';
    :触发退款流程;
    |财务/支付系统|
    :执行退款操作(原路退回);
    :向用户支付账户退款;
    |系统|
    :更新售后单状态为 'REFUNDED';
    :更新订单状态为 'REFUNDED';
    :通知用户退款已完成;
    |用户|
    :收到退款成功消息;
    stop
  else (否, 货物损坏)
    |客服/管理员|
    :联系用户沟通处理;
    stop
  endif
else (否, 审核不通过)
  |系统|
  :更新售后单状态为 'REJECTED';
  :记录拒绝原因;
  :通知用户申请被驳回;
  |用户|
  :收到申请被驳回的通知;
  stop
endif

@enduml 